{"version":3,"file":"Text.js","sourceRoot":"","sources":["../../../../../src/.internal/core/elements/Text.ts"],"names":[],"mappings":"AAAA;;GAEG;;;;;;;;;;;AAEH;;;;;GAKG;AACH,OAAO,EAAE,MAAM,EAAqF,MAAM,WAAW,CAAC;AAQtH,OAAO,EAAE,MAAM,EAAE,MAAM,WAAW,CAAC;AAInC,OAAO,EAAY,aAAa,EAAE,MAAM,mBAAmB,CAAC;AAE5D,OAAO,KAAK,KAAK,MAAM,eAAe,CAAC;AACvC,OAAO,KAAK,MAAM,MAAM,gBAAgB,CAAC;AACzC,OAAO,KAAK,KAAK,MAAM,mBAAmB,CAAC;AAC3C,OAAO,KAAK,KAAK,MAAM,eAAe,CAAC;AACvC,OAAO,EAAE,iBAAiB,EAAE,MAAM,oCAAoC,CAAC;AA0JtE,CAAC;AAiBF;;;;;GAKG;AAEH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GAkDG;AACH;IAA0B,wBAAM;IAsD/B;;OAEG;IACH;QAAA;QAEC,8BAA8B;QAC9B,iBAAO,SAgEP;QApGD;;;;WAIG;QACI,iBAAW,GAAY,KAAK,CAAC;QAiCnC,sBAAsB;QACtB,KAAI,CAAC,SAAS,GAAG,MAAM,CAAC;QAExB,qBAAqB;QACrB,KAAI,CAAC,OAAO,GAAG,KAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QAExC,KAAI,CAAC,IAAI,GAAG,IAAI,iBAAiB,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;QACnD,KAAI,CAAC,cAAc,GAAG,MAAM,CAAC;QAC7B,KAAI,CAAC,UAAU,GAAG,QAAQ,CAAC;QAE3B,eAAe;QACf,KAAI,CAAC,IAAI,GAAG,KAAK,CAAC;QAClB,KAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACtB,KAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACtB,KAAI,CAAC,SAAS,GAAG,OAAO,CAAC;QACzB,KAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QAExB,KAAI,CAAC,kBAAkB,GAAG,CAAC,CAAC;QAE5B,iDAAiD;QACjD,KAAI,CAAC,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,UAAC,GAAG;YACnC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;gBAEV,GAAG,GAAG,KAAI,CAAC,cAAc,CACxB,MAAM,CAAC,SAAS,CACf,CAAC,MAAM,CAAC,KAAK,CAAC,KAAI,CAAC,IAAI,CAAC;oBACvB,CAAC,CAAC,KAAI,CAAC,IAAI;oBACX,CAAC,CAAC,KAAI,CAAC,IAAI,CACZ,CACD,CAAC;YAEH,CAAC;YACD,MAAM,CAAC,GAAG,CAAC;QACZ,CAAC,CAAC,CAAC;QAEH,oEAAoE;QACpE,kBAAkB;QAClB,KAAI,CAAC,MAAM,CAAC,EAAE,CAAC,gBAAgB,EAAE,UAAC,EAAE;YACnC,EAAE,CAAC,CACF,CAAC,KAAI,CAAC,KAAK,CAAC,KAAK,GAAG,KAAI,CAAC,cAAc,CAAC;mBACrC,CAAC,CAAC,KAAI,CAAC,KAAK,CAAC,KAAK,GAAG,KAAI,CAAC,cAAc,CAAC,IAAI,KAAI,CAAC,WAAW,CAAC;mBAC9D,CAAC,KAAI,CAAC,KAAK,CAAC,MAAM,GAAG,KAAI,CAAC,eAAe,CAAC;mBAC1C,CAAC,CAAC,KAAI,CAAC,KAAK,CAAC,MAAM,GAAG,KAAI,CAAC,eAAe,CAAC,IAAI,KAAI,CAAC,WAAW,CACnE,CAAC,CAAC,CAAC;gBACF,KAAI,CAAC,UAAU,EAAE,CAAC;YACnB,CAAC;YACD,IAAI,CAAC,CAAC;gBACL,KAAI,CAAC,YAAY,EAAE,CAAC;YACrB,CAAC;QACF,CAAC,CAAC,CAAC;QAEH,yEAAyE;QACzE,KAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE;YAC1B,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,EAAE;gBAChC,EAAE,CAAA,CAAC,KAAI,CAAC,MAAM,CAAC,CAAA,CAAC;oBACf,KAAI,CAAC,MAAM,CAAC,UAAU,EAAE,CAAC;gBAC1B,CAAC;YACF,CAAC,CAAC,CAAA;QACH,CAAC,EAAE,KAAI,CAAC,CAAC;QAET,aAAa;QACb,KAAI,CAAC,UAAU,EAAE,CAAC;;IACnB,CAAC;IAED;;;;;;OAMG;IACI,qBAAM,GAAb;QACC,EAAE,CAAC,CAAC,IAAI,CAAC,iBAAiB,EAAE,CAAC,CAAC,CAAC;YAC9B,IAAI,CAAC,UAAU,EAAE,CAAC;QACnB,CAAC;IACF,CAAC;IAED;;;;;OAKG;IACO,gCAAiB,GAA3B;QACC,0BAA0B;QAC1B,IAAI,MAAc,EAAE,IAAY,CAAC;QAEjC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,qBAAqB,EAAE,CAAC,CAAC,CAAC;YAEpE,sEAAsE;YACtE,MAAM,GAAG,MAAM,CAAC;YAChB,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;QAElB,CAAC;QACD,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAEnC,8CAA8C;YAC9C,MAAM,GAAG,KAAK,CAAC;YACf,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;QAElB,CAAC;QACD,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAEnC,sEAAsE;YACtE,MAAM,GAAG,KAAK,CAAC;YACf,IAAI,GAAG,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAEpC,CAAC;QACD,IAAI,CAAC,CAAC;YACL,2BAA2B;YAC3B,IAAI,GAAG,EAAE,CAAC;YACV,MAAM,CAAC;QAER,CAAC;QAED,eAAe;QACf,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC3B,MAAM,CAAC;QACR,CAAC;QAED,mCAAmC;QACnC,EAAE,CAAC,CAAC,IAAI,KAAK,EAAE,CAAC,CAAC,CAAC;YACjB,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;QACjD,CAAC;QAED,kBAAkB;QAClB,IAAI,OAAO,GAAG,IAAI,IAAI,IAAI,CAAC,YAAY,IAAI,MAAM,IAAI,IAAI,CAAC,cAAc,CAAC;QACzE,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QACzB,IAAI,CAAC,cAAc,GAAG,MAAM,CAAC;QAC7B,MAAM,CAAC,OAAO,CAAC;IAChB,CAAC;IAED;;;;OAIG;IACI,mBAAI,GAAX;QAEC,aAAa;QACb,iBAAM,IAAI,WAAE,CAAC;QAEb,QAAQ;QACR,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;QAEzB,cAAc;QACd,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAEzB,0BAA0B;QAC1B,IAAI,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC;QACjC,IAAI,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC;QAE7B,eAAe;QACf,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC3B,MAAM,CAAC;QACR,CAAC;QAED,0BAA0B;QAC1B,8DAA8D;QAC9D,IAAI,KAAK,GAAa,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QAEvC,0DAA0D;QAC1D,IAAI,OAAO,GAAY,IAAI,CAAC,CAAA,mCAAmC;QAE/D,iCAAiC;QACjC,IAAI,QAAQ,GAAW,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC,CAAC,CAAC;QAC1G,IAAI,SAAS,GAAW,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC;QAE5G,eAAe;QACf,EAAE,CAAC,CAAC,MAAM,KAAK,KAAK,CAAC,CAAC,CAAC;YAEtB;;eAEG;YAEH,oBAAoB;YACpB,IAAI,KAAK,GAAiB,IAAI,CAAC,OAAO,CAAC;YACvC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC;gBAC5B,KAAK,CAAC,eAAe,EAAE,CAAC;gBACxB,IAAI,CAAC,SAAS,EAAE,CAAC;YAClB,CAAC;YACD,IAAI,CAAC,CAAC;gBACL,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;YACvB,CAAC;YAED,uBAAuB;YACvB,IAAI,aAAa,GAAW,CAAC,CAAC;YAC9B,IAAI,aAAa,GAAW,EAAE,CAAC;YAE/B,oBAAoB;YACpB,GAAG,CAAC,CAAC,IAAI,CAAC,GAAW,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;gBAE/C,WAAW;gBACX,IAAI,IAAI,GAAW,KAAK,CAAC,CAAC,CAAC,CAAC;gBAE5B,2CAA2C;gBAC3C,IAAI,MAAM,GAAiB,MAAM,CAAC,aAAa,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gBAC5D,IAAI,iBAAiB,GAAW,CAAC,EAAE,gBAAgB,GAAW,CAAC,CAAC;gBAChE,IAAI,UAAU,GAAY,IAAI,CAAC;gBAC/B,IAAI,cAAc,GAAY,KAAK,CAAC;gBAEpC,4CAA4C;gBAC5C,IAAI,QAAQ,SAAe,CAAC;gBAC5B,EAAE,CAAC,CAAC,IAAI,CAAC,gBAAgB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/D,aAAa;oBACb,QAAQ,CAAC,OAAO,CAAC,WAAW,GAAG,EAAE,CAAC;gBACnC,CAAC;gBACD,IAAI,CAAC,CAAC;oBAEL,qBAAqB;oBACrB,QAAQ,GAAG;wBACV,SAAS,EAAE,IAAI,CAAC,iBAAiB,CAAC,EAAE,EAAE,CAAC,CAAC;wBACxC,SAAS,EAAE,KAAK;qBAChB,CAAC;oBAEF,0BAA0B;oBAC1B,mDAAmD;oBACnD,8CAA8C;oBAC9C,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;gBAE7B,CAAC;gBAED,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;oBACd,MAAM,CAAC,OAAO,EAAE,CAAC;gBAClB,CAAC;gBAED,qBAAqB;gBACrB,GAAG,CAAC,CAAC,IAAI,CAAC,GAAW,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;oBAEhD,8DAA8D;oBAC9D,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;wBACP,QAAQ,CAAC,OAAO,GAAG,IAAI,CAAC;oBACzB,CAAC;oBAED,YAAY;oBACZ,IAAI,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;oBAEtB,gCAAgC;oBAChC,EAAE,CAAC,CAAC,KAAK,CAAC,IAAI,KAAK,QAAQ,CAAC,CAAC,CAAC;wBAE7B,mEAAmE;wBACnE,YAAY;wBACZ,aAAa,GAAG,KAAK,CAAC,IAAI,CAAC;oBAE5B,CAAC;oBACD,IAAI,CAAC,CAAC;wBAEL,kBAAkB;wBAElB,gBAAgB;wBAChB,gEAAgE;wBAChE,yDAAyD;wBACzD,8DAA8D;wBAC9D,EAAE,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC;4BACpB,QAAQ,CAAC;wBACV,CAAC;wBAED,mBAAmB;wBACnB,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;4BACb;;;;+BAIG;4BAEH,mCAAmC;4BACnC,2GAA2G;4BAC3G,QAAQ,CAAC,OAAO,CAAC,GAAG,CACnB,MAAM,CAAC,aAAa,CAAC,aAAa,CACjC,KAAK,CAAC,IAAI,EACV,MAAM,CAAC,aAAa,CAAC,uBAAuB,CAAC,aAAa,CAAC,CAC3D,CACD,CAAC;4BAEF,0BAA0B;4BAC1B,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,gBAAgB,IAAI,CAAC,QAAQ,CAAC,IAAI,IAAI,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC;gCAClE,QAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;gCAC3C,QAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;4BACtD,CAAC;4BAED,8BAA8B;4BAC9B,EAAE,CAAC,CAAC,iBAAiB,GAAG,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;gCAC9C,iBAAiB,GAAG,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC;4BAC1C,CAAC;4BAED,YAAY;4BACZ,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;gCAEtE,gBAAgB;gCAChB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;gCAExB,8BAA8B;gCAC9B,IAAI,QAAQ,GAAW,QAAQ,CAAC,OAAO,CAAC,WAAW,CAAC;gCACpD,IAAI,YAAY,GAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gCAExE,8CAA8C;gCAC9C,IAAI,WAAW,GAAW,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC,GAAG,YAAY,CAAC,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAC;gCAEjH,2CAA2C;gCAC3C,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;oCAEnB;;;;;;;uCAOG;oCAEH,2DAA2D;oCAC3D,uDAAuD;oCACvD,4DAA4D;oCAC5D,sCAAsC;oCACtC,IAAI,WAAW,GAAY,KAAK,CAAC;oCAEjC,4DAA4D;oCAC5D,yCAAyC;oCACzC,4BAA4B;oCAC5B,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;wCAEhE,sBAAsB;wCACtB,IAAI,OAAO,GAAc,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;wCAG/D,0DAA0D;wCAC1D,8BAA8B;wCAC9B,gDAAgD;wCAChD,EAAE,CAAC,CAAC,WAAW,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,IAAI,QAAQ,CAAC,CAAC,CAAC,CAAC;4CAEtD,eAAe;4CACf,OAAO,CAAC,WAAW,IAAI,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC;4CAE3C,qDAAqD;4CACrD,QAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;4CAC3C,QAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;4CAEtD,8BAA8B;4CAC9B,oCAAoC;4CACpC,EAAE,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,IAAI,QAAQ,CAAC,CAAC,CAAC;gDACrC,KAAK,CAAC;4CACP,CAAC;wCAEF,CAAC;wCACD,WAAW,GAAG,KAAK,CAAC;wCAEpB,mBAAmB;wCACnB,IAAI,WAAW,GAAG,OAAO,CAAC,WAAW,CAAC;wCAEtC,8CAA8C;wCAC9C,QAAQ,GAAG,QAAQ,CAAC,OAAO,CAAC,WAAW,CAAC;wCACxC,WAAW,GAAG,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC,GAAG,YAAY,CAAC,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAC;wCAErG,uBAAuB;wCACvB,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,WAAW,IAAI,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,EAAE,CAAC;4CAElG,gCAAgC;4CAChC,IAAI,QAAQ,GAAW,KAAK,CAAC,GAAG,CAAC,WAAW,CAAC,MAAM,GAAG,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;4CAE7F,0BAA0B;4CAC1B,EAAE,CAAC,CAAC,QAAQ,IAAI,CAAC,CAAC,CAAC,CAAC;gDAEnB,wCAAwC;gDACxC,uDAAuD;gDACvD,0BAA0B;gDAC1B,WAAW,GAAG,CAAC,CAAC;gDAEhB,gCAAgC;gDAChC,wDAAwD;gDACxD,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;oDAEX,8CAA8C;oDAC9C,WAAW,GAAG,IAAI,CAAC;oDAEnB,qBAAqB;oDACrB,QAAQ,CAAC,OAAO,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;gDACzC,CAAC;4CAEF,CAAC;4CAED,0DAA0D;4CAC1D,8BAA8B;4CAC9B,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;gDACb,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,WAAW,EAAE,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;4CAClG,CAAC;4CACD,IAAI,CAAC,CAAC;gDACL,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,WAAW,EAAE,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;4CACjG,CAAC;4CAED,qBAAqB;4CACrB,OAAO,CAAC,WAAW,GAAG,WAAW,CAAC;4CAElC,gBAAgB;4CAChB,QAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;4CAC3C,QAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;4CAGtD,0DAA0D;4CAC1D,4CAA4C;4CAC5C,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,GAAG,GAAG,CAAC,CAAC;wCAE5C,CAAC;wCAED,gCAAgC;wCAChC,cAAc,GAAG,IAAI,CAAC;oCAEvB,CAAC;gCAEF,CAAC;gCACD,IAAI,CAAC,CAAC;oCAEL;;;;;uCAKG;oCACH,qCAAqC;oCACrC,IAAI,aAAW,GAAc,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC;oCAExD,mBAAmB;oCACnB,IAAI,UAAU,SAAU,CAAC;oCACzB,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,WAAW,IAAI,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,EAAE,CAAC;wCAElG,gCAAgC;wCAChC,IAAI,QAAQ,GAAW,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,GAAG,WAAW,EAAE,CAAC,CAAC,CAAC;wCAErE,6DAA6D;wCAC7D,cAAc;wCACd,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;4CAEhB,8BAA8B;4CAC9B,UAAU,GAAG,MAAM,CAAC,oBAAoB,CAAC,KAAK,CAAC,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;wCAEjF,CAAC;wCACD,IAAI,CAAC,CAAC;4CAEL,uBAAuB;4CACvB,UAAU,GAAG,MAAM,CAAC,oBAAoB,CAAC,KAAK,CAAC,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;4CAE/E,sCAAsC;4CACtC,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,QAAQ,CAAC,IAAI,QAAQ,KAAK,CAAC,CAAC,CAAC,CAAC;gDAEzD,8CAA8C;gDAC9C,mCAAmC;gDACnC,QAAQ,CAAC,OAAO,CAAC,aAAa,CAAC,aAAW,CAAC,CAAC;gDAE5C,uCAAuC;gDACvC,WAAW,GAAG,CAAC,CAAC;4CACjB,CAAC;wCAEF,CAAC;wCAED,yCAAyC;wCACzC,EAAE,CAAC,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC,CAAC;4CACrB,aAAW,CAAC,WAAW,GAAG,MAAM,CAAC,aAAa,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;wCACzF,CAAC;wCAED,8BAA8B;wCAC9B,QAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;wCAC3C,QAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;wCAEtD,0DAA0D;wCAC1D,4CAA4C;wCAC5C,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,GAAG,GAAG,CAAC,CAAC;oCAE5C,CAAC;oCAED,iCAAiC;oCACjC,EAAE,CAAC,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;wCAE3B,IAAI,UAAU,GAAW,EAAE,CAAC;wCAE5B,iDAAiD;wCACjD,EAAE,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;4CAEhC,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;gDACd,UAAU,IAAI,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,aAAa,CAAC;4CACnD,CAAC;4CACD,IAAI,CAAC,CAAC;gDACL,UAAU,IAAI,aAAa,GAAG,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;4CACnD,CAAC;wCAEF,CAAC;wCAED,6BAA6B;wCAC7B,GAAG,CAAC,CAAC,IAAI,CAAC,GAAW,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;4CACpD,UAAU,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;wCAC9B,CAAC;wCAED,wDAAwD;wCACxD,KAAK,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,UAAU,CAAC,CAAC;oCACpC,CAAC;oCACD,yCAAyC;oCACzC,cAAc,GAAG,IAAI,CAAC;gCACvB,CAAC;4BACF,CAAC;4BAED,mDAAmD;4BACnD,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;gCAC5C,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC;4BACxC,CAAC;4BACD,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,aAAa,GAAG,iBAAiB,CAAC;4BAEtD,wBAAwB;4BACxB,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC;gCACrB,GAAG,EAAE,GAAG;gCACR,GAAG,EAAE,aAAa,GAAG,iBAAiB;gCACtC,IAAI,EAAE,CAAC,CAAC,GAAG,GAAG,iBAAiB,CAAC,CAAC,QAAQ,EAAE;6BAC3C,CAAC,CAAC;wBAEJ,CAAC;wBACD,IAAI,CAAC,CAAC;4BAEL;;;+BAGG;4BAEH,QAAQ,CAAC,OAAO,CAAC,GAAG,CACnB,MAAM,CAAC,aAAa,CAAC,aAAa,CACjC,KAAK,CAAC,IAAI,EACV,MAAM,CAAC,aAAa,CAAC,uBAAuB,CAAC,aAAa,CAAC,CAC3D,CACD,CAAC;wBAEH,CAAC;wBAED,UAAU,GAAG,KAAK,CAAC;oBAEpB,CAAC;gBAEF,CAAC;gBAED,qBAAqB;gBACrB,IAAI,WAAW,GAAc,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC;gBACxD,EAAE,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;oBACjB,WAAW,CAAC,WAAW,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;wBACnC,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,CAAC;wBACvC,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;gBACxC,CAAC;gBAED,8BAA8B;gBAC9B,aAAa,IAAI,iBAAiB,CAAC;gBAEnC,+BAA+B;gBAC/B,EAAE,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC;oBAC3B,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;gBAC5B,CAAC;YAEF,CAAC;YAED,mEAAmE;YACnE,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,IAAI,CAAC,CAAC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;gBACpH,IAAI,CAAC,IAAI,EAAE,CAAC;gBACZ,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;YACzB,CAAC;YACD,IAAI,CAAC,CAAC;gBACL,IAAI,CAAC,IAAI,EAAE,CAAC;YACb,CAAC;YAED,kBAAkB;YAClB,IAAI,CAAC,YAAY,EAAE,CAAC;QAErB,CAAC;QACD,IAAI,CAAC,CAAC;YAEL;;eAEG;YAEH,kDAAkD;YAClD,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,aAAa,EAAE,CAAC;YAC1C,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC9B,IAAI,CAAC,SAAS,EAAE,CAAC;YAEjB,+BAA+B;YAC/B,IAAI,KAAK,GAAW,QAAQ,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,QAAQ,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC;YACzE,IAAI,MAAM,GAAW,SAAS,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,QAAQ,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC;YAC5E,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;gBACjB,OAAO,EAAE,KAAK;gBACd,QAAQ,EAAE,MAAM;aAChB,CAAC,CAAC;YAEH,sBAAsB;YACtB,yGAAyG;YACzG,IAAI,WAAW,GAAgB,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC;YAC7D,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;YAE3C,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QAEzB,CAAC;QAED,wBAAwB;QACxB,IAAI,CAAC,SAAS,EAAE,CAAC;IAElB,CAAC;IAED;;;;OAIG;IACI,2BAAY,GAAnB;QAAA,iBAsDC;QApDA,YAAY;QACZ,IAAI,KAAK,GAAiB,IAAI,CAAC,OAAO,CAAC;QAEvC,8BAA8B;QAC9B,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;YACrB,MAAM,CAAC;QACR,CAAC;QAED,sBAAsB;QACtB,IAAI,QAAQ,GAAW,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC,CAAC,CAAC;QAE1G,0BAA0B;QAC1B,6CAA6C;QAC7C,IAAI,KAAK,GAAW,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QAE1D,oBAAoB;QACpB,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,SAAS,EAAE,CAAC,QAAQ,EAAE,EAAE,UAAC,OAAO;YACzD,qBAAqB;YACrB,0EAA0E;YAC1E,sCAAsC;YACtC,MAAM,CAAC,CAAC,KAAI,CAAC,SAAS,CAAC,CAAC,CAAC;gBACxB,KAAK,QAAQ;oBACZ,OAAO,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;oBAC9C,OAAO,CAAC,IAAI,CAAC,EAAE,aAAa,EAAE,QAAQ,EAAE,CAAC,CAAC;oBAC1C,KAAK,CAAC;gBACP,KAAK,KAAK;oBACT,EAAE,CAAC,CAAC,KAAI,CAAC,GAAG,CAAC,CAAC,CAAC;wBACd,OAAO,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC;wBAC3B,OAAO,CAAC,IAAI,CAAC,EAAE,aAAa,EAAE,KAAK,EAAE,CAAC,CAAC;oBACxC,CAAC;oBACD,IAAI,CAAC,CAAC;wBACL,OAAO,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;wBAC1C,OAAO,CAAC,IAAI,CAAC,EAAE,aAAa,EAAE,KAAK,EAAE,CAAC,CAAC;oBACxC,CAAC;oBACD,KAAK,CAAC;gBACP;oBACC,EAAE,CAAC,CAAC,KAAI,CAAC,GAAG,CAAC,CAAC,CAAC;wBACd,OAAO,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;wBAC1C,OAAO,CAAC,IAAI,CAAC,EAAE,aAAa,EAAE,OAAO,EAAE,CAAC,CAAC;oBAC1C,CAAC;oBACD,IAAI,CAAC,CAAC;wBACL,OAAO,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC;wBAC3B,OAAO,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;oBACnC,CAAC;oBACD,KAAK,CAAC;YAER,CAAC;YAED,mBAAmB;YACnB,eAAe;QAChB,CAAC,CAAC,CAAC;IAEJ,CAAC;IAED;;;;;;;;OAQG;IACI,gCAAiB,GAAxB,UAAyB,IAAY,EAAE,CAAU;QAEhD,oCAAoC;QACpC,IAAI,OAAO,GAAU,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QACjD,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC;QAE3B,iBAAiB;QACjB,OAAO,CAAC,IAAI,CAAC;YACZ,GAAG,EAAE,GAAG;YACR,kCAAkC;YAClC,2BAA2B;YAC3B,yBAAyB;SACzB,CAAC,CAAC;QAEH,mBAAmB;QACnB,EAAE,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACvB,OAAO,CAAC,IAAI,CAAC;gBACZ,GAAG,EAAE,CAAC,CAAC,QAAQ,EAAE;aACjB,CAAC,CAAC;QACJ,CAAC;QAED,iDAAiD;QACjD,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YAChC,OAAO,CAAC,IAAI,CAAC,EAAE,UAAU,EAAE,QAAQ,EAAE,CAAC,CAAC;QACxC,CAAC;QAED,WAAW;QACX,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YACd,OAAO,CAAC,IAAI,CAAC;gBACZ,WAAW,EAAE,KAAK;gBAClB,cAAc,EAAE,eAAe;aAC/B,CAAC,CAAC;QACJ,CAAC;QAED,MAAM,CAAC,OAAO,CAAC;IAChB,CAAC;IAED;;;;;;OAMG;IACI,yBAAU,GAAjB,UAAkB,QAAoB;QACrC,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;YACvC,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC;QACnC,CAAC;QACD,IAAI,CAAC,KAAK,CAAC,MAAM,IAAI,QAAQ,CAAC,MAAM,CAAC;IACtC,CAAC;IAED;;;;OAIG;IACI,wBAAS,GAAhB;QACC,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,CAAC;IAClD,CAAC;IAED;;;;;;OAMG;IACI,iCAAkB,GAAzB,UAA0B,IAAY;QAErC,2BAA2B;QAC3B,IAAI,GAAG,GAAgB,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QACrD,GAAG,CAAC,SAAS,GAAG,IAAI,CAAC;QAErB,sBAAsB;QACtB,MAAM,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;YACxB,KAAK,QAAQ;gBACZ,GAAG,CAAC,KAAK,CAAC,SAAS,GAAG,QAAQ,CAAC;gBAC/B,KAAK,CAAC;YACP,KAAK,KAAK;gBACT,GAAG,CAAC,KAAK,CAAC,SAAS,GAAG,OAAO,CAAC;gBAC9B,KAAK,CAAC;QACR,CAAC;QAED,6BAA6B;QAC7B,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YACf,GAAG,CAAC,KAAK,CAAC,QAAQ,GAAG,YAAY,CAAC;QACnC,CAAC;QACD,IAAI,CAAC,CAAC;YACL,GAAG,CAAC,KAAK,CAAC,UAAU,GAAG,QAAQ,CAAC;QACjC,CAAC;QAED,iDAAiD;QACjD,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;YACnB,GAAG,CAAC,KAAK,CAAC,QAAQ,GAAG,QAAQ,CAAC;QAC/B,CAAC;QAED,yBAAyB;QACzB,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YACd,GAAG,CAAC,KAAK,CAAC,SAAS,GAAG,KAAK,CAAC;YAC5B,GAAG,CAAC,KAAK,CAAC,WAAW,GAAG,eAAe,CAAC;QACzC,CAAC;QAED,MAAM,CAAC,GAAG,CAAC;IACZ,CAAC;IAED;;;;;;OAMG;IACI,wBAAS,GAAhB;QACC,IAAI,KAAK,GAAiB,IAAI,CAAC,OAAO,CAAC;QACvC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;YAC5E,KAAK,CAAC,QAAQ,CAAC;gBACd,kBAAkB,EAAE,MAAM;gBAC1B,cAAc,EAAE,MAAM;gBACtB,eAAe,EAAE,MAAM;aACvB,CAAC,CAAC;QACJ,CAAC;QACD,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;YAC1B,KAAK,CAAC,WAAW,CAAC,kBAAkB,CAAC,CAAC;YACtC,KAAK,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;YAClC,KAAK,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC;QACpC,CAAC;IACF,CAAC;IAWD,sBAAW,sBAAI;QAKf;;;;WAIG;aACH;YACC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;QACtC,CAAC;QArBD;;;;;;;;WAQG;aACH,UAAgB,KAAa;YAC5B,2CAA2C;YAC3C,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QAC5C,CAAC;;;OAAA;IAgBD,sBAAW,sBAAI;QAKf;;;;WAIG;aACH;YACC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;QACtC,CAAC;QAjBD;;;;WAIG;aACH,UAAgB,KAAc;YAC7B,IAAI,CAAC,SAAS,EAAE,CAAC;YACjB,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QAC5C,CAAC;;;OAAA;IAuBD,sBAAW,0BAAQ;QAKnB;;;;WAIG;aACH;YACC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC;QAC1C,CAAC;QAxBD;;;;;;;;;;;WAWG;aACH,UAAoB,KAAc;YACjC,IAAI,CAAC,SAAS,EAAE,CAAC;YACjB,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QAChD,CAAC;;;OAAA;IAiBD,sBAAW,0BAAQ;QAInB;;;;WAIG;aACH;YACC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC;QAC1C,CAAC;QAjBD;;;;;WAKG;aACH,UAAoB,KAAa;YAChC,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QAChD,CAAC;;;OAAA;IAmBD,sBAAW,4BAAU;QAKrB;;;;WAIG;aACH;YACC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;QAC5C,CAAC;QApBD;;;;;;;WAOG;aACH,UAAsB,KAAc;YACnC,IAAI,CAAC,gBAAgB,CAAC,YAAY,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;YACjD,IAAI,CAAC,SAAS,EAAE,CAAC;QAClB,CAAC;;;OAAA;IAqBD,sBAAW,2BAAS;QAIpB;;;;WAIG;aACH;YACC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAAC,CAAC;QAC3C,CAAC;QArBD;;;;;;;;;WASG;aACH,UAAqB,KAAgB;YACpC,IAAI,CAAC,gBAAgB,CAAC,WAAW,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QACjD,CAAC;;;OAAA;IAkBD,sBAAW,4BAAU;QAIrB;;;;;;WAMG;aACH;YACC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;QAC5C,CAAC;QApBD;;;;;;WAMG;aACH,UAAsB,KAAiB;YACtC,IAAI,CAAC,gBAAgB,CAAC,YAAY,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QAClD,CAAC;;;OAAA;IAqBD,sBAAW,0BAAQ;QAKnB;;;;WAIG;aACH;YACC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC;QAC1C,CAAC;QApBD;;;;;;;WAOG;aACH,UAAoB,KAAU;YAC7B,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;YAC/C,IAAI,CAAC,eAAe,CAAC,EAAE,WAAW,EAAE,KAAK,EAAE,CAAC,CAAC;QAC9C,CAAC;;;OAAA;IAkBD,sBAAW,4BAAU;QAKrB;;;;WAIG;aACH;YACC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;QAC5C,CAAC;QAnBD;;;;;;WAMG;aACH,UAAsB,KAAiB;YACtC,IAAI,CAAC,gBAAgB,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;YAC3C,IAAI,CAAC,eAAe,CAAC,EAAE,aAAa,EAAE,KAAK,EAAE,CAAC,CAAC;QAChD,CAAC;;;OAAA;IAkBD,sBAAW,gCAAc;QAKzB;;;;WAIG;aACH;YACC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,CAAC;QAChD,CAAC;QAnBD;;;;;;WAMG;aACH,UAA0B,KAAqB;YAC9C,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,EAAE,KAAK,CAAC,CAAC;YAC/C,IAAI,CAAC,eAAe,CAAC,EAAE,iBAAiB,EAAE,KAAK,EAAE,CAAC,CAAC;QACpD,CAAC;;;OAAA;IAwBD,sBAAW,sBAAI;QAIf;;;;WAIG;aACH;YACC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;QACtC,CAAC;QAxBD;;;;;;;;;;;;WAYG;aACH,UAAgB,KAAa;YAC5B,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QAC5C,CAAC;;;OAAA;IAiBD,sBAAW,+BAAa;QAIxB;;;;WAIG;aACH;YACC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,eAAe,CAAC,CAAC;QAC/C,CAAC;QAjBD;;;;;WAKG;aACH,UAAyB,KAAc;YACtC,IAAI,CAAC,gBAAgB,CAAC,eAAe,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QACrD,CAAC;;;OAAA;IAWD;;;OAGG;IACO,6BAAc,GAAxB,cAAmC,CAAC;IAEpC;;;;;;OAMG;IACI,0BAAW,GAAlB,UAAmB,KAAa;QAC/B,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QACtC,MAAM,CAAC,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;IACxD,CAAC;IAED;;;;;;;OAOG;IACI,0BAAW,GAAlB,UAAmB,IAAmB,EAAE,OAAiB,EAAE,KAAc;QACxE,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACtC,CAAC;IAED;;OAEG;IACK,4BAAa,GAArB;QACC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YAChC,IAAI,CAAC,QAAQ,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;QAC/B,CAAC;IACF,CAAC;IAED;;;;;;OAMG;IACI,0BAAW,GAAlB,UAAmB,QAAkB;QACpC,EAAE,CAAC,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC,CAAC;YAChC,IAAI,CAAC,qBAAqB,CAAC,OAAO,EAAE,CAAC;QACtC,CAAC;QACD,EAAE,CAAA,CAAC,QAAQ,CAAC,CAAA,CAAC;YACZ,IAAI,CAAC,qBAAqB,GAAG,IAAI,aAAa,CAAC;gBAC9C,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC,cAAc,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC;gBACzD,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC,qBAAqB,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC;gBAChE,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC,iBAAiB,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC;aAC5D,CAAC,CAAC;QACJ,CAAC;QACD,iBAAM,WAAW,YAAC,QAAQ,CAAC,CAAC;IAC7B,CAAC;IAQD,sBAAW,gCAAc;QANzB;;;;;WAKG;aACH;YACC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC;QACxE,CAAC;;;OAAA;IAOD,sBAAW,iCAAe;QAL1B;;;;WAIG;aACH;YACC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;QAC3E,CAAC;;;OAAA;IAED;;;;;;;OAOG;IACI,yBAAU,GAAjB;QACC,iBAAM,UAAU,WAAE,CAAC;QACnB,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC,wDAAwD;IAC5E,CAAC;IAEF,WAAC;AAAD,CAAC,AA/rCD,CAA0B,MAAM,GA+rC/B","sourcesContent":["/**\r\n * Text class deals with all text placed on chart.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Sprite, ISpriteProperties, ISpriteAdapters, ISpriteEvents, SpriteEventDispatcher, AMEvent } from \"../Sprite\";\r\nimport { DataItem } from \"../DataItem\";\r\nimport { List } from \"../utils/List\";\r\nimport { TextValign } from \"../defs/TextValign\";\r\nimport { TextAlign } from \"../defs/TextAlign\";\r\nimport { IRectangle } from \"../defs/IRectangle\";\r\nimport { AMElement } from \"../rendering/AMElement\";\r\nimport { Group } from \"../rendering/Group\";\r\nimport { system } from \"../System\";\r\nimport { ITextChunk } from \"../formatters/TextFormatter\";\r\nimport { HorizontalCenter } from \"../defs/HorizontalCenter\";\r\nimport { VerticalCenter } from \"../defs/VerticalCenter\";\r\nimport { Disposer, MultiDisposer } from \"../utils/Disposer\";\r\nimport { color } from \"../utils/Color\";\r\nimport * as $math from \"../utils/Math\";\r\nimport * as $utils from \"../utils/Utils\";\r\nimport * as $iter from \"../utils/Iterator\";\r\nimport * as $type from \"../utils/Type\";\r\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines available font weights.\r\n *\r\n * @type {string}\r\n */\r\nexport type FontWeight = \"normal\" | \"bold\" | \"bolder\" | \"lighter\" | \"100\" | \"200\" | \"300\" | \"400\" | \"500\" | \"600\" | \"700\" | \"800\" | \"900\";\r\n\r\n/**\r\n * Defines available text decorations.\r\n *\r\n * @type {string}\r\n */\r\nexport type TextDecoration = \"none\" | \"underline\" | \"overline\" | \"line-through\" | \"blink\";\r\n\r\n/**\r\n * Defines properties for [[Text]].\r\n */\r\nexport interface ITextProperties extends ISpriteProperties {\r\n\r\n\t/**\r\n\t * Horizontal align of the text.\r\n\t *\r\n\t * @default \"start\"\r\n\t * @type {TextAlign}\r\n\t */\r\n\ttextAlign?: TextAlign;\r\n\r\n\t/**\r\n\t * Vertical align of the text.\r\n\t *\r\n\t * @default \"top\"\r\n\t * @type {TextValign}\r\n\t */\r\n\ttextValign?: TextValign;\r\n\r\n\t/**\r\n\t * A plain text content.\r\n\t *\r\n\t * @type {string}\r\n\t */\r\n\ttext?: string;\r\n\r\n\t/**\r\n\t * Should the lines wrap if they do not fit into max width?\r\n\t *\r\n\t * @default false\r\n\t * @type {boolean}\r\n\t */\r\n\twrap?: boolean;\r\n\r\n\t/**\r\n\t * Should the text be selectable>\r\n\t *\r\n\t * @default false\r\n\t * @type {boolean}\r\n\t */\r\n\tselectable?: boolean;\r\n\r\n\t/**\r\n\t * HTML content.\r\n\t *\r\n\t * @type {string}\r\n\t */\r\n\thtml?: string;\r\n\r\n\t/**\r\n\t * Font size for the text.\r\n\t *\r\n\t * @type {number}\r\n\t */\r\n\tfontSize?: number;\r\n\r\n\t/**\r\n\t * Should the lines be truncated (optionally with ellipsis) if they do not\r\n\t * fit into max width?\r\n\t *\r\n\t * @default false\r\n\t * @type {boolean}\r\n\t */\r\n\ttruncate?: boolean;\r\n\r\n\t/**\r\n\t * If lines are truncated, this ellipsis will be added at the end.\r\n\t *\r\n\t * @default \"...\"\r\n\t * @type {string}\r\n\t */\r\n\tellipsis?: string;\r\n\r\n\t/**\r\n\t * Hide text of it does not fit into element's dimensions?\r\n\t *\r\n\t * @default false\r\n\t * @type {boolean}\r\n\t */\r\n\thideOversized?: boolean;\r\n\r\n\t/**\r\n\t * Default font weight.\r\n\t *\r\n\t * @default \"normal\"\r\n\t * @type {FontWeight}\r\n\t */\r\n\tfontWeigth?: FontWeight;\r\n\r\n\t/**\r\n\t * Default font decoration.\r\n\t *\r\n\t * @default \"none\"\r\n\t * @type {TextDecoration}\r\n\t */\r\n\ttextDecoration?: TextDecoration;\r\n\r\n}\r\n\r\n/**\r\n * Text line information.\r\n *\r\n * Objects used to hold cached information about lines in a Text element.\r\n */\r\nexport interface ITextLineInfo {\r\n\r\n\t/**\r\n\t * Measurements for the bounding box of the line.\r\n\t *\r\n\t * @type {SVGRect}\r\n\t */\r\n\t\"bbox\"?: SVGRect,\r\n\r\n\t/**\r\n\t * A reference to an SVG `<g>` element that holds line elements.\r\n\t *\r\n\t * @type {Group}\r\n\t */\r\n\t\"element\"?: Group,\r\n\r\n\t/**\r\n\t * Indicates if line contains more than one element, e.g. has multiple\r\n\t * formatted blocks.\r\n\t *\r\n\t * @type {boolean}\r\n\t */\r\n\t\"complex\"?: boolean\r\n\r\n};\r\n\r\n/**\r\n * Defines events for [[Text]].\r\n */\r\nexport interface ITextEvents extends ISpriteEvents { }\r\n\r\n/**\r\n * Adapters for [[Text]].\r\n *\r\n * Includes both the [[Adapter]] definitions and properties.\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface ITextAdapters extends ISpriteAdapters, ITextProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Text is used to display highly configurable, data-enabled textual elements.\r\n *\r\n * ## Data Binding\r\n *\r\n * A Text element can dynamically parse and populate its contents with values\r\n * from a [[DataItem]].\r\n *\r\n * To activate such binding, set element's `dataItem` property.\r\n *\r\n * When activated, text contents will be parsed for special tags, e.g.:\r\n *\r\n * ```TypeScript\r\n * label.dataItem = myDataItem;\r\n * label.text = \"The title is: ${title}\";\r\n * ```\r\n * ```JavaScript\r\n * label.dataItem = myDataItem;\r\n * label.text = \"The title is: ${title}\";\r\n * ```\r\n *\r\n * The above will atuomatically replace \"${title}\" in the string with the\r\n * actual data value from `myDataItem`.\r\n *\r\n * ## Fast Rendering\r\n *\r\n * Creating elements in SVG is expensive. If you are redrawing textual elements\r\n * constantly, like animating a value, you might consider enabling \"shallow\r\n * rendering\".\r\n *\r\n * ```TypeScript\r\n * text.shallowRendering = true;\r\n * ```\r\n * ```JavaScript\r\n * text.shallowRendering = true;\r\n * ```\r\n *\r\n * If this is set to `true` [[Text]] will try to re-use cached line height\r\n * and DOM elements in order to speed up rendering as much as possible.\r\n *\r\n * The downside is that dimensions of the text element might change during\r\n * the process, making it not fit into selected bounds, and/or not well\r\n * aligned.\r\n *\r\n *\r\n * @see {@link ITextEvents} for a list of available events\r\n * @see {@link ITextAdapters} for a list of available Adapters\r\n * @todo Vertical align\r\n * @todo Linkage to relative documentation (formatters, data binding)\r\n * @important\r\n */\r\nexport class Text extends Sprite {\r\n\t/**\r\n\t * Defines available properties.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @type {ITextProperties}\r\n\t */\r\n\tpublic _properties: ITextProperties;\r\n\r\n\t/**\r\n\t * Defines Adapter type.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @type {ITextAdapters}\r\n\t */\r\n\tpublic _adapter: ITextAdapters;\r\n\r\n\t/**\r\n\t * Event dispatcher.\r\n\t *\r\n\t * @type {SpriteEventDispatcher<AMEvent<Text, ITextEvents>>} Event dispatcher instance\r\n\t */\r\n\tpublic events: SpriteEventDispatcher<AMEvent<Text, ITextEvents>>;\r\n\r\n\t/**\r\n\t * Indicates if the whole text does not fit into max dimenstions set for it.\r\n\t *\r\n\t * @type {boolean}\r\n\t */\r\n\tpublic isOversized: boolean = false;\r\n\r\n\t/**\r\n\t * Currently formatted text. This is used to verifying if text element needs\r\n\t * to be redrawn.\r\n\t *\r\n\t * @type {string}\r\n\t */\r\n\tprotected _currentText: string;\r\n\r\n\t/**\r\n\t * Current format to be used for outputing text.\r\n\t *\r\n\t * @type {string}\r\n\t */\r\n\tprotected _currentFormat: string;\r\n\r\n\t/**\r\n\t * [_sourceDataItemEvents description]\r\n\t *\r\n\t * @todo Description\r\n\t * @type {MultiDisposer}\r\n\t */\r\n\tprotected _sourceDataItemEvents: MultiDisposer;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Execute super's constructor\r\n\t\tsuper();\r\n\r\n\t\t// Set this class name\r\n\t\tthis.className = \"Text\";\r\n\r\n\t\t// Create the element\r\n\t\tthis.element = this.paper.addGroup(\"g\");\r\n\r\n\t\tthis.fill = new InterfaceColorSet().getFor(\"text\");\r\n\t\tthis.textDecoration = \"none\";\r\n\t\tthis.fontWeigth = \"normal\";\r\n\r\n\t\t// Set defaults\r\n\t\tthis.wrap = false;\r\n\t\tthis.truncate = false;\r\n\t\tthis.ellipsis = \"...\";\r\n\t\tthis.textAlign = \"start\";\r\n\t\tthis.textValign = \"top\";\r\n\r\n\t\tthis.renderingFrequency = 2;\r\n\r\n\t\t// Set up adapters for manipulating accessibility\r\n\t\tthis.adapter.add(\"readerTitle\", (arg) => {\r\n\t\t\tif (!arg) {\r\n\r\n\t\t\t\targ = this.populateString(\r\n\t\t\t\t\t$utils.plainText(\r\n\t\t\t\t\t\t!$utils.empty(this.html)\r\n\t\t\t\t\t\t\t? this.html\r\n\t\t\t\t\t\t\t: this.text\r\n\t\t\t\t\t)\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\t\t\treturn arg;\r\n\t\t});\r\n\r\n\t\t// Add events to watch for maxWidth/maxHeight changes so that we can\r\n\t\t// invalidate this\r\n\t\tthis.events.on(\"maxsizechanged\", (ev) => {\r\n\t\t\tif (\r\n\t\t\t\t(this._bbox.width > this.availableWidth)\r\n\t\t\t\t|| ((this._bbox.width < this.availableWidth) && this.isOversized)\r\n\t\t\t\t|| (this._bbox.height > this.availableHeight)\r\n\t\t\t\t|| ((this._bbox.height < this.availableHeight) && this.isOversized)\r\n\t\t\t) {\r\n\t\t\t\tthis.invalidate();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.alignSVGText();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// helps to avoid a strange bug which incorrectly measures text elementz\\\r\n\t\tthis.events.once(\"inited\", ()=>{\r\n\t\t\tsystem.events.once(\"enterframe\", ()=>{\r\n\t\t\t\tif(this.parent){\r\n\t\t\t\t\tthis.parent.invalidate();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}, this);\r\n\r\n\t\t// Aply theme\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Redraws the element, but only if the text actually changed from the\r\n\t * currently displayed one.\r\n\t *\r\n\t * This is useful for saving processing power by eliminating unnecessary\r\n\t * expensive redraws.\r\n\t */\r\n\tpublic update(): void {\r\n\t\tif (this.updateCurrentText()) {\r\n\t\t\tthis.invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates current text according to data item and supported features.\r\n\t * Returns `true` if current text has changed.\r\n\t *\r\n\t * @return {boolean} Text changed?\r\n\t */\r\n\tprotected updateCurrentText(): boolean {\r\n\t\t// Determine output format\r\n\t\tlet output: string, text: string;\r\n\r\n\t\tif (!$utils.empty(this.html) && this.paper.supportsForeignObject()) {\r\n\r\n\t\t\t// We favor HTML text if it's set and browser supports `foreignObject`\r\n\t\t\toutput = \"html\";\r\n\t\t\ttext = this.html;\r\n\r\n\t\t}\r\n\t\telse if (!$utils.empty(this.text)) {\r\n\r\n\t\t\t// HTML not set or not supported, use SVG text\r\n\t\t\toutput = \"svg\";\r\n\t\t\ttext = this.text;\r\n\r\n\t\t}\r\n\t\telse if (!$utils.empty(this.html)) {\r\n\r\n\t\t\t// SVG is not set, let's strip the tags out of HTML and display as SVG\r\n\t\t\toutput = \"svg\";\r\n\t\t\ttext = $utils.stripTags(this.html);\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Empty, noting to do here\r\n\t\t\ttext = \"\";\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t// Empty string\r\n\t\tif (!$type.hasValue(text)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Need to format text all the time\r\n\t\tif (text !== \"\") {\r\n\t\t\ttext = this.populateString(text, this.dataItem);\r\n\t\t}\r\n\r\n\t\t// Update the text\r\n\t\tlet changed = text != this._currentText || output != this._currentFormat;\r\n\t\tthis._currentText = text;\r\n\t\tthis._currentFormat = output;\r\n\t\treturn changed;\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the textual label.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic draw(): void {\r\n\r\n\t\t// Draw super\r\n\t\tsuper.draw();\r\n\r\n\t\t// Reset\r\n\t\tthis.isOversized = false;\r\n\r\n\t\t// Update text\r\n\t\tthis.updateCurrentText();\r\n\r\n\t\t// Determine output format\r\n\t\tlet output = this._currentFormat;\r\n\t\tlet text = this._currentText;\r\n\r\n\t\t// Empty string\r\n\t\tif (!$type.hasValue(text)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Chop up text into lines\r\n\t\t// We're still processing SVG and HTML in the same way for now\r\n\t\tlet lines: string[] = text.split(\"\\n\");\r\n\r\n\t\t// Do we need to go through the trouble of measuring lines\r\n\t\tlet measure: boolean = true;// (lines.length > 1) || this.wrap;\r\n\r\n\t\t// Calculate max width and height\r\n\t\tlet maxWidth: number = $math.max(this.availableWidth - this.pixelPaddingLeft - this.pixelPaddingRight, 0);\r\n\t\tlet maxHeight: number = $math.max(this.availableHeight - this.pixelPaddingTop - this.pixelPaddingBottom, 0);\r\n\r\n\t\t// SVG or HTML?\r\n\t\tif (output === \"svg\") {\r\n\r\n\t\t\t/**\r\n\t\t\t * SVG\r\n\t\t\t */\r\n\r\n\t\t\t// Clear the element\r\n\t\t\tlet group: Group = <Group>this.element;\r\n\t\t\tif (!this.shallowRendering) {\r\n\t\t\t\tgroup.disposeChildren();\r\n\t\t\t\tthis.resetBBox();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._bbox.height = 0;\r\n\t\t\t}\r\n\r\n\t\t\t// Init state variables\r\n\t\t\tlet currentHeight: number = 0;\r\n\t\t\tlet currentFormat: string = \"\";\r\n\r\n\t\t\t// Process each line\r\n\t\t\tfor (let i: number = 0; i < lines.length; i++) {\r\n\r\n\t\t\t\t// Get line\r\n\t\t\t\tlet line: string = lines[i];\r\n\r\n\t\t\t\t// Chunk up the line and process each chunk\r\n\t\t\t\tlet chunks: ITextChunk[] = system.textFormatter.chunk(line);\r\n\t\t\t\tlet currentLineHeight: number = 0, currentLineWidth: number = 0;\r\n\t\t\t\tlet firstChunk: boolean = true;\r\n\t\t\t\tlet skipTextChunks: boolean = false;\r\n\r\n\t\t\t\t// Create line element or grab it from cache\r\n\t\t\t\tlet lineInfo: ITextLineInfo;\r\n\t\t\t\tif (this.shallowRendering && (lineInfo = this.getLineInfo(i))) {\r\n\t\t\t\t\t// Empty line\r\n\t\t\t\t\tlineInfo.element.textContent = \"\";\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\r\n\t\t\t\t\t// Init new line info\r\n\t\t\t\t\tlineInfo = {\r\n\t\t\t\t\t\t\"element\": this.getSVGLineElement(\"\", 0),\r\n\t\t\t\t\t\t\"complex\": false\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// Create the line element\r\n\t\t\t\t\t//lineInfo.element = this.getSVGLineElement(\"\", 0);\r\n\t\t\t\t\t//lineElement = this.getSVGLineElement(\"\", 0);\r\n\t\t\t\t\tgroup.add(lineInfo.element);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.rtl) {\r\n\t\t\t\t\tchunks.reverse();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Process each chunk\r\n\t\t\t\tfor (let x: number = 0; x < chunks.length; x++) {\r\n\r\n\t\t\t\t\t// If there's more than one chunk, means the line is \"complex\"\r\n\t\t\t\t\tif (x) {\r\n\t\t\t\t\t\tlineInfo.complex = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Get chunk\r\n\t\t\t\t\tlet chunk = chunks[x];\r\n\r\n\t\t\t\t\t// Is this chunk format or text?\r\n\t\t\t\t\tif (chunk.type === \"format\") {\r\n\r\n\t\t\t\t\t\t// Log current format, so that we can apply it to multiple lines if\r\n\t\t\t\t\t\t// necessary\r\n\t\t\t\t\t\tcurrentFormat = chunk.text;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\r\n\t\t\t\t\t\t// It's text block\r\n\r\n\t\t\t\t\t\t// Need to skip?\r\n\t\t\t\t\t\t// We do this when truncating. We can't just simply go ahead and\r\n\t\t\t\t\t\t// abandon chunk processing as they might have formatting\r\n\t\t\t\t\t\t// instructions in them that are relevant for subsequent lines\r\n\t\t\t\t\t\tif (skipTextChunks) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Needs measuring?\r\n\t\t\t\t\t\tif (measure) {\r\n\t\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t\t * The text needs measuring\r\n\t\t\t\t\t\t\t * We will use the temporary element to measure stuff before\r\n\t\t\t\t\t\t\t * adding it to the main \"production\" element\r\n\t\t\t\t\t\t\t */\r\n\r\n\t\t\t\t\t\t\t// Add chunk to the current element\r\n\t\t\t\t\t\t\t//lineInfo.element.content += $utils.trim(system.textFormatter.format(currentFormat + chunk.text, output));\r\n\t\t\t\t\t\t\tlineInfo.element.add(\r\n\t\t\t\t\t\t\t\tsystem.textFormatter.getSvgElement(\r\n\t\t\t\t\t\t\t\t\tchunk.text,\r\n\t\t\t\t\t\t\t\t\tsystem.textFormatter.translateStyleShortcuts(currentFormat)\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\t// Measure it if necessary\r\n\t\t\t\t\t\t\tif (!this.shallowRendering || !lineInfo.bbox || lineInfo.complex) {\r\n\t\t\t\t\t\t\t\tlineInfo.bbox = lineInfo.element.getBBox();\r\n\t\t\t\t\t\t\t\tlineInfo.bbox.width = Math.ceil(lineInfo.bbox.width);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Updated current line height\r\n\t\t\t\t\t\t\tif (currentLineHeight < lineInfo.bbox.height) {\r\n\t\t\t\t\t\t\t\tcurrentLineHeight = lineInfo.bbox.height;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Wrapping?\r\n\t\t\t\t\t\t\tif ((this.wrap || this.truncate) && (lineInfo.bbox.width > maxWidth)) {\r\n\r\n\t\t\t\t\t\t\t\t// Set oversized\r\n\t\t\t\t\t\t\t\tthis.isOversized = true;\r\n\r\n\t\t\t\t\t\t\t\t// Take temporary measurements\r\n\t\t\t\t\t\t\t\tlet lineText: string = lineInfo.element.textContent;\r\n\t\t\t\t\t\t\t\tlet avgCharWidth: number = (lineInfo.bbox.width / lineText.length) * .9;\r\n\r\n\t\t\t\t\t\t\t\t// Calculate average number of symbols / width\r\n\t\t\t\t\t\t\t\tlet excessChars: number = $math.min(Math.ceil((lineInfo.bbox.width - maxWidth) / avgCharWidth), lineText.length);\r\n\r\n\t\t\t\t\t\t\t\t// Are we truncating or auto-wrapping text?\r\n\t\t\t\t\t\t\t\tif (this.truncate) {\r\n\r\n\t\t\t\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t\t\t\t * Processing line truncation\r\n\t\t\t\t\t\t\t\t\t * With the addition of each text chunk we measure if current\r\n\t\t\t\t\t\t\t\t\t * line does not exceed maxWidth. If it does, we will stop\r\n\t\t\t\t\t\t\t\t\t * addition of further chunks as well as try to truncate\r\n\t\t\t\t\t\t\t\t\t * current or any number of previous chunks with an added\r\n\t\t\t\t\t\t\t\t\t * ellipsis\r\n\t\t\t\t\t\t\t\t\t */\r\n\r\n\t\t\t\t\t\t\t\t\t// Indicator whether we need to add ellipsis to the current\r\n\t\t\t\t\t\t\t\t\t// element, even if it fits. This is needed to indicate\r\n\t\t\t\t\t\t\t\t\t// whether we have already removed some subsequent chunks in\r\n\t\t\t\t\t\t\t\t\t// which case we need to add ellipsis.\r\n\t\t\t\t\t\t\t\t\tlet addEllipsis: boolean = false;\r\n\r\n\t\t\t\t\t\t\t\t\t// Process each child in the temporary line, until the whole\r\n\t\t\t\t\t\t\t\t\t// line fits, preferably with an ellipsis\r\n\t\t\t\t\t\t\t\t\t// TODO use iterator instead\r\n\t\t\t\t\t\t\t\t\tfor (let e = lineInfo.element.children.length - 1; e >= 0; e--) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Get current element\r\n\t\t\t\t\t\t\t\t\t\tlet element: AMElement = lineInfo.element.children.getIndex(e);\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Add ellipsis only if previous chunk was removed in full\r\n\t\t\t\t\t\t\t\t\t\t// and this chunk already fits\r\n\t\t\t\t\t\t\t\t\t\t//if (addEllipsis && (bbox.width <= maxWidth)) {\r\n\t\t\t\t\t\t\t\t\t\tif (addEllipsis && (lineInfo.bbox.width <= maxWidth)) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Add ellipsis\r\n\t\t\t\t\t\t\t\t\t\t\telement.textContent += \" \" + this.ellipsis;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Measure again (we need to make sure ellipsis fits)\r\n\t\t\t\t\t\t\t\t\t\t\tlineInfo.bbox = lineInfo.element.getBBox();\r\n\t\t\t\t\t\t\t\t\t\t\tlineInfo.bbox.width = Math.floor(lineInfo.bbox.width);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// If it fits, we're done here\r\n\t\t\t\t\t\t\t\t\t\t\t// If it doesn't we continue rolling\r\n\t\t\t\t\t\t\t\t\t\t\tif (lineInfo.bbox.width <= maxWidth) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\taddEllipsis = false;\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Get element text\r\n\t\t\t\t\t\t\t\t\t\tlet elementText = element.textContent;\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Calculate average number of symbols / width\r\n\t\t\t\t\t\t\t\t\t\tlineText = lineInfo.element.textContent;\r\n\t\t\t\t\t\t\t\t\t\texcessChars = $math.min(Math.ceil((lineInfo.bbox.width - maxWidth) / avgCharWidth), lineText.length);\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Do this until we fit\r\n\t\t\t\t\t\t\t\t\t\twhile ((lineInfo.bbox.width > maxWidth) && (excessChars <= lineText.length) && (excessChars > 0)) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Calculate max available chars\r\n\t\t\t\t\t\t\t\t\t\t\tlet maxChars: number = $math.max(elementText.length - excessChars - this.ellipsis.length, 1);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Is there anything left?\r\n\t\t\t\t\t\t\t\t\t\t\tif (maxChars <= 1) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Nope, let's jump to the previous item\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Set excess characters to zero so that this loop does\r\n\t\t\t\t\t\t\t\t\t\t\t\t// not repeat when it over\r\n\t\t\t\t\t\t\t\t\t\t\t\texcessChars = 0;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Add ellipsis to previous item\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Subsequent iterations will check if the ellipsis fits\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (e > 0) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Indicating to add ellipsis to previous item\r\n\t\t\t\t\t\t\t\t\t\t\t\t\taddEllipsis = true;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Removing this node\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlineInfo.element.removeElement(element);\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// If we're on first chunk of text, we can break mid-word.\r\n\t\t\t\t\t\t\t\t\t\t\t// Otherwise we break by words\r\n\t\t\t\t\t\t\t\t\t\t\tif (e === 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\telementText = $utils.truncateWithEllipsis(elementText, maxChars, this.ellipsis, false, this.rtl);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\t\t\telementText = $utils.truncateWithEllipsis(elementText, maxChars, this.ellipsis, true, this.rtl);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Set truncated text\r\n\t\t\t\t\t\t\t\t\t\t\telement.textContent = elementText;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Measure again\r\n\t\t\t\t\t\t\t\t\t\t\tlineInfo.bbox = lineInfo.element.getBBox();\r\n\t\t\t\t\t\t\t\t\t\t\tlineInfo.bbox.width = Math.floor(lineInfo.bbox.width);\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Increase excess characters count, just in case it still\r\n\t\t\t\t\t\t\t\t\t\t\t// doesn't fit and we have to go at it again\r\n\t\t\t\t\t\t\t\t\t\t\texcessChars = Math.ceil(excessChars * 1.1);\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Do not process further chunks\r\n\t\t\t\t\t\t\t\t\t\tskipTextChunks = true;\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\r\n\t\t\t\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t\t\t\t * Processign auto-wrap\r\n\t\t\t\t\t\t\t\t\t * In this case we're going to be adding text chunks until\r\n\t\t\t\t\t\t\t\t\t * they don't fit into current line. Once that happens we will\r\n\t\t\t\t\t\t\t\t\t * inject the rest of the chunks to the next line\r\n\t\t\t\t\t\t\t\t\t */\r\n\t\t\t\t\t\t\t\t\t// Get last node added and measure it\r\n\t\t\t\t\t\t\t\t\tlet lastElement: AMElement = lineInfo.element.lastChild;\r\n\r\n\t\t\t\t\t\t\t\t\t// Init split lines\r\n\t\t\t\t\t\t\t\t\tlet splitLines: string[];\r\n\t\t\t\t\t\t\t\t\twhile ((lineInfo.bbox.width > maxWidth) && (excessChars <= lineText.length) && (excessChars > 0)) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Calculate max available chars\r\n\t\t\t\t\t\t\t\t\t\tlet maxChars: number = $math.max(chunk.text.length - excessChars, 1);\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Don't split the words mid-word if it's not the first chunk\r\n\t\t\t\t\t\t\t\t\t\t// in the line\r\n\t\t\t\t\t\t\t\t\t\tif (firstChunk) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Split mid-word if necessary\r\n\t\t\t\t\t\t\t\t\t\t\tsplitLines = $utils.splitTextByCharCount(chunk.text, maxChars, false, this.rtl);\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\telse {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Don't split mid-word\r\n\t\t\t\t\t\t\t\t\t\t\tsplitLines = $utils.splitTextByCharCount(chunk.text, maxChars, true, this.rtl);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Check if the first word is too long\r\n\t\t\t\t\t\t\t\t\t\t\tif ((splitLines[0].length > maxChars) || maxChars === 1) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Yes - move the whole chunk to the next line\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Remove the element we just added\r\n\t\t\t\t\t\t\t\t\t\t\t\tlineInfo.element.removeElement(lastElement);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Break out of the while on next cycle\r\n\t\t\t\t\t\t\t\t\t\t\t\texcessChars = 0;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Use the first line to update last item\r\n\t\t\t\t\t\t\t\t\t\tif (excessChars > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\tlastElement.textContent = system.textFormatter.cleanUp($utils.trim(splitLines.shift()));\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Measure again, just in case\r\n\t\t\t\t\t\t\t\t\t\tlineInfo.bbox = lineInfo.element.getBBox();\r\n\t\t\t\t\t\t\t\t\t\tlineInfo.bbox.width = Math.floor(lineInfo.bbox.width);\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Increase excess characters count, just in case it still\r\n\t\t\t\t\t\t\t\t\t\t// doesn't fit and we have to go at it again\r\n\t\t\t\t\t\t\t\t\t\texcessChars = Math.ceil(excessChars * 1.1);\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// Construct the rest of the line\r\n\t\t\t\t\t\t\t\t\tif (splitLines.length > 0) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tlet restOfLine: string = \"\";\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Add leftovers from splitting the current chunk\r\n\t\t\t\t\t\t\t\t\t\tif ($type.hasValue(splitLines)) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif (this.rtl) {\r\n\t\t\t\t\t\t\t\t\t\t\t\trestOfLine += splitLines.join(\"\") + currentFormat;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\t\t\trestOfLine += currentFormat + splitLines.join(\"\");\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Add the rest of the chunks\r\n\t\t\t\t\t\t\t\t\t\tfor (let c: number = x + 1; c < chunks.length; c++) {\r\n\t\t\t\t\t\t\t\t\t\t\trestOfLine += chunks[c].text;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Inject the rest of the lines as chunks for subsequent\r\n\t\t\t\t\t\t\t\t\t\tlines.splice(i + 1, 0, restOfLine);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t// Skip processing the rest of the chunks\r\n\t\t\t\t\t\t\t\t\tskipTextChunks = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Let's update the text's bbox with the line's one\r\n\t\t\t\t\t\t\tif (this._bbox.width < lineInfo.bbox.width) {\r\n\t\t\t\t\t\t\t\tthis._bbox.width = lineInfo.bbox.width;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis._bbox.height = currentHeight + currentLineHeight;\r\n\r\n\t\t\t\t\t\t\t// Position current line\r\n\t\t\t\t\t\t\tlineInfo.element.attr({\r\n\t\t\t\t\t\t\t\t\"x\": \"0\",\r\n\t\t\t\t\t\t\t\t\"y\": currentHeight + currentLineHeight,\r\n\t\t\t\t\t\t\t\t\"dy\": (-0.2 * currentLineHeight).toString()\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\r\n\t\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t\t * Does not need measuring\r\n\t\t\t\t\t\t\t * Let's just plop everything to the main element\r\n\t\t\t\t\t\t\t */\r\n\r\n\t\t\t\t\t\t\tlineInfo.element.add(\r\n\t\t\t\t\t\t\t\tsystem.textFormatter.getSvgElement(\r\n\t\t\t\t\t\t\t\t\tchunk.text,\r\n\t\t\t\t\t\t\t\t\tsystem.textFormatter.translateStyleShortcuts(currentFormat)\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfirstChunk = false;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Trim the last item\r\n\t\t\t\tlet lastElement: AMElement = lineInfo.element.lastChild;\r\n\t\t\t\tif (lastElement) {\r\n\t\t\t\t\tlastElement.textContent = this.rtl ?\r\n\t\t\t\t\t\t$utils.ltrim(lastElement.textContent) :\r\n\t\t\t\t\t\t$utils.rtrim(lastElement.textContent);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Increment collective height\r\n\t\t\t\tcurrentHeight += currentLineHeight;\r\n\r\n\t\t\t\t// Save line cache if necessary\r\n\t\t\t\tif (this.shallowRendering) {\r\n\t\t\t\t\tthis.addLineInfo(lineInfo);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Check if maybe we need to hide the whole label if it doesn't fit\r\n\t\t\tif (this.hideOversized && ((this.availableWidth < this._bbox.width) || (this.availableHeight < this._bbox.height))) {\r\n\t\t\t\tthis.hide();\r\n\t\t\t\tthis.isOversized = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.show();\r\n\t\t\t}\r\n\r\n\t\t\t// Align the lines\r\n\t\t\tthis.alignSVGText();\r\n\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\t/**\r\n\t\t\t * HTML\r\n\t\t\t */\r\n\r\n\t\t\t// Create a ForeignObject to use as HTML container\r\n\t\t\tthis.element = this.paper.foreignObject();\r\n\t\t\tthis.paper.append(this.group);\r\n\t\t\tthis.resetBBox();\r\n\r\n\t\t\t// Set ForeignObject dimensions\r\n\t\t\tlet width: string = maxWidth > 0 ? (maxWidth).toString() + \"px\" : \"100%\";\r\n\t\t\tlet height: string = maxHeight > 0 ? (maxHeight).toString() + \"px\" : \"100%\";\r\n\t\t\tthis.element.attr({\r\n\t\t\t\t\"width\": width,\r\n\t\t\t\t\"height\": height\r\n\t\t\t});\r\n\r\n\t\t\t// Create line element\r\n\t\t\t//let lineElement: HTMLElement = this.getHTMLLineElement(system.textFormatter.format(this.html, output));\r\n\t\t\tlet lineElement: HTMLElement = this.getHTMLLineElement(text);\r\n\t\t\tthis.element.node.appendChild(lineElement);\r\n\r\n\t\t\tthis.isOversized = true;\r\n\r\n\t\t}\r\n\r\n\t\t// Set applicable styles\r\n\t\tthis.setStyles();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Aligns the lines horizontally ant vertically, based on properties.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic alignSVGText(): void {\r\n\r\n\t\t// Ger Group\r\n\t\tlet group: Group = <Group>this.element;\r\n\r\n\t\t// Is there anything to align?\r\n\t\tif (!group.children) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Calculate max width\r\n\t\tlet maxWidth: number = $math.max(this.availableWidth - this.pixelPaddingLeft - this.pixelPaddingRight, 0);\r\n\r\n\t\t// Measure the whole stuff\r\n\t\t//let bbox: SVGRect = this.element.getBBox();\r\n\t\tlet width: number = $math.max(this._bbox.width, maxWidth);\r\n\r\n\t\t// Process each line\r\n\t\t$iter.each(group.children.backwards().iterator(), (element) => {\r\n\t\t\t// Align horizontally\r\n\t\t\t// Since we are using `text-anchor` for horizontal alignement, all we need\r\n\t\t\t// to do here is move the `x` position\r\n\t\t\tswitch (this.textAlign) {\r\n\t\t\t\tcase \"middle\":\r\n\t\t\t\t\telement.attr({ \"x\": (width / 2).toString() });\r\n\t\t\t\t\telement.attr({ \"text-anchor\": \"middle\" });\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"end\":\r\n\t\t\t\t\tif (this.rtl) {\r\n\t\t\t\t\t\telement.attr({ \"x\": \"0\" });\r\n\t\t\t\t\t\telement.attr({ \"text-anchor\": \"end\" });\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\telement.attr({ \"x\": (width).toString() });\r\n\t\t\t\t\t\telement.attr({ \"text-anchor\": \"end\" });\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif (this.rtl) {\r\n\t\t\t\t\t\telement.attr({ \"x\": (width).toString() });\r\n\t\t\t\t\t\telement.attr({ \"text-anchor\": \"start\" });\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\telement.attr({ \"x\": \"0\" });\r\n\t\t\t\t\t\telement.removeAttr(\"text-anchor\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Align vertically\r\n\t\t\t// @todo Maybe?\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Produces an SVG line element with formatted text.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param  {string}     text    Text to wrap into line\r\n\t * @param  {number}     y       Current line vertical position\r\n\t * @return {AMElement}          A DOM element\r\n\t * @todo Implement HTML support\r\n\t */\r\n\tpublic getSVGLineElement(text: string, y?: number): Group {\r\n\r\n\t\t// Create a <text> node and set text\r\n\t\tlet element: Group = this.paper.addGroup(\"text\");\r\n\t\telement.textContent = text;\r\n\r\n\t\t// Set parameters\r\n\t\telement.attr({\r\n\t\t\t\"x\": \"0\"\r\n\t\t\t//\"alignment-baseline\": \"hanging\",\r\n\t\t\t//\"baseline-shift\": \"-20%\",\r\n\t\t\t//\"text-anchor\": \"center\"\r\n\t\t});\r\n\r\n\t\t// Set `y` position\r\n\t\tif ($type.hasValue(y)) {\r\n\t\t\telement.attr({\r\n\t\t\t\t\"y\": y.toString()\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Don't let labels blled out of the alotted area\r\n\t\tif (this.truncate || this.wrap) {\r\n\t\t\telement.attr({ \"overflow\": \"hidden\" });\r\n\t\t}\r\n\r\n\t\t// Add RTL?\r\n\t\tif (this.rtl) {\r\n\t\t\telement.attr({\r\n\t\t\t\t\"direction\": \"rtl\",\r\n\t\t\t\t\"unicode-bidi\": \"bidi-override\"\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates cached bbox dimensions for each text line, just so we don't have to\r\n\t * measure the whole element all over again when we're done painting it.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param {IRectangle} lineBBox Line's BBox\r\n\t */\r\n\tpublic updateBBox(lineBBox: IRectangle): void {\r\n\t\tif (this._bbox.width < lineBBox.width) {\r\n\t\t\tthis._bbox.width = lineBBox.width;\r\n\t\t}\r\n\t\tthis._bbox.height += lineBBox.height;\r\n\t}\r\n\r\n\t/**\r\n\t * Resets cached BBox.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic resetBBox(): void {\r\n\t\tthis._bbox = { x: 0, y: 0, width: 0, height: 0 };\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns an HTML line element (`<div>`).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param  {string}       text  Text to add\r\n\t * @return {HTMLElement}        `<div>` element reference\r\n\t */\r\n\tpublic getHTMLLineElement(text: string): HTMLElement {\r\n\r\n\t\t// Create the <div> element\r\n\t\tlet div: HTMLElement = document.createElement(\"div\");\r\n\t\tdiv.innerHTML = text;\r\n\r\n\t\t// Set text alignement\r\n\t\tswitch (this.textAlign) {\r\n\t\t\tcase \"middle\":\r\n\t\t\t\tdiv.style.textAlign = \"center\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"end\":\r\n\t\t\t\tdiv.style.textAlign = \"right\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// Disable or enable wrapping\r\n\t\tif (this.wrap) {\r\n\t\t\tdiv.style.wordWrap = \"break-word\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdiv.style.whiteSpace = \"nowrap\";\r\n\t\t}\r\n\r\n\t\t// Don't let labels blled out of the alotted area\r\n\t\tif (this.truncate) {\r\n\t\t\tdiv.style.overflow = \"hidden\";\r\n\t\t}\r\n\r\n\t\t// Set RTL-related styles\r\n\t\tif (this.rtl) {\r\n\t\t\tdiv.style.direction = \"rtl\";\r\n\t\t\tdiv.style.unicodeBidi = \"bidi-override\";\r\n\t\t}\r\n\r\n\t\treturn div;\r\n\t}\r\n\r\n\t/**\r\n\t * Applies specific styles to text to make it not selectable, unless it is\r\n\t * explicitly set as `selectable`.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Set styles via AMElement\r\n\t */\r\n\tpublic setStyles(): void {\r\n\t\tlet group: Group = <Group>this.element;\r\n\t\tif (!this.selectable || this.draggable || this.resizable || this.swipeable) {\r\n\t\t\tgroup.addStyle({\r\n\t\t\t\t\"webkitUserSelect\": \"none\",\r\n\t\t\t\t\"msUserSelect\": \"none\",\r\n\t\t\t\t\"pointerEvents\": \"none\"\r\n\t\t\t});\r\n\t\t}\r\n\t\telse if (this.selectable) {\r\n\t\t\tgroup.removeStyle(\"webkitUserSelect\");\r\n\t\t\tgroup.removeStyle(\"msUserSelect\");\r\n\t\t\tgroup.removeStyle(\"pointerEvents\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets SVG text.\r\n\t *\r\n\t * Please note that setting `html` will override this setting if browser\r\n\t * supports `foreignObject` in SGV, such as most modern browsers excluding\r\n\t * IEs.\r\n\t *\r\n\t * @param {string} value SVG Text\r\n\t */\r\n\tpublic set text(value: string) {\r\n\t\t//this.setPropertyValue(\"html\", undefined);\r\n\t\tthis.setPropertyValue(\"text\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current SVG text.\r\n\t *\r\n\t * @return {string} SVG text\r\n\t */\r\n\tpublic get text(): string {\r\n\t\treturn this.getPropertyValue(\"text\");\r\n\t}\r\n\r\n\t/**\r\n\t * Enables or disables autowrapping of text.\r\n\t *\r\n\t * @param {boolean} value Auto-wrapping enabled\r\n\t */\r\n\tpublic set wrap(value: boolean) {\r\n\t\tthis.resetBBox();\r\n\t\tthis.setPropertyValue(\"wrap\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current auto-wrap setting.\r\n\t *\r\n\t * @return {boolean} Auto-wrap enabled or not\r\n\t */\r\n\tpublic get wrap(): boolean {\r\n\t\treturn this.getPropertyValue(\"wrap\");\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if text lines need to be truncated if they do not fit, using\r\n\t * configurable `ellipsis` string.\r\n\t *\r\n\t * `truncate` overrides `wrap` if both are set to `true`.\r\n\t *\r\n\t * NOTE: For HTML text, this setting **won't** trigger a parser and actual\r\n\t * line truncation with ellipsis. It will just hide everything that goes\r\n\t * outside the label.\r\n\t *\r\n\t * @param {boolean}  value  trincate text?\r\n\t */\r\n\tpublic set truncate(value: boolean) {\r\n\t\tthis.resetBBox();\r\n\t\tthis.setPropertyValue(\"truncate\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current truncation setting.\r\n\t *\r\n\t * @return {boolean} Truncate text?\r\n\t */\r\n\tpublic get truncate(): boolean {\r\n\t\treturn this.getPropertyValue(\"truncate\");\r\n\t}\r\n\r\n\t/**\r\n\t * Sets ellipsis character to use if `truncate` is enabled.\r\n\t *\r\n\t * @param {string} value Ellipsis string\r\n\t * @default \"...\"\r\n\t */\r\n\tpublic set ellipsis(value: string) {\r\n\t\tthis.setPropertyValue(\"ellipsis\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current ellipsis setting.\r\n\t *\r\n\t * @return {string} Ellipsis string\r\n\t */\r\n\tpublic get ellipsis(): string {\r\n\t\treturn this.getPropertyValue(\"ellipsis\");\r\n\t}\r\n\r\n\t/**\r\n\t * Forces the text to be selectable. This setting will be ignored if the\r\n\t * object has some kind of interaction attached to it, such as it is\r\n\t * `draggable`, `swipeable`, `resizable`.\r\n\t *\r\n\t * @param {boolean}  value  Text selectable?\r\n\t * @default false\r\n\t */\r\n\tpublic set selectable(value: boolean) {\r\n\t\tthis.setPropertyValue(\"selectable\", value, true);\r\n\t\tthis.setStyles();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current setting for selectable text.\r\n\t *\r\n\t * @return {boolean} Text selectable?\r\n\t */\r\n\tpublic get selectable(): boolean {\r\n\t\treturn this.getPropertyValue(\"selectable\");\r\n\t}\r\n\r\n\t/**\r\n\t * Sets text alignement.\r\n\t *\r\n\t * Available choices:\r\n\t * * \"start\"\r\n\t * * \"middle\"\r\n\t * * \"end\"\r\n\t *\r\n\t * @param {TextAlign} value Alignement\r\n\t */\r\n\tpublic set textAlign(value: TextAlign) {\r\n\t\tthis.setPropertyValue(\"textAlign\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current horizontal text alignement.\r\n\t *\r\n\t * @return {TextAlign} Alignement\r\n\t */\r\n\tpublic get textAlign(): TextAlign {\r\n\t\treturn this.getPropertyValue(\"textAlign\");\r\n\t}\r\n\r\n\t/**\r\n\t * Sets vertical text alignement.\r\n\t *\r\n\t * @ignore Exclude from docs (not used)\r\n\t * @param {TextValign} value Alignement\r\n\t * @deprecated\r\n\t */\r\n\tpublic set textValign(value: TextValign) {\r\n\t\tthis.setPropertyValue(\"textValign\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns vertical text alignement.\r\n\t *\r\n\t * @ignore Exclude from docs (not used)\r\n\t * @return {TextValign} Alignement\r\n\t * @deprecated\r\n\t */\r\n\tpublic get textValign(): TextValign {\r\n\t\treturn this.getPropertyValue(\"textValign\");\r\n\t}\r\n\r\n\t/**\r\n\t * Sets font size to be used for the text. The size can either be numeric, in\r\n\t * pxels, or other measurements.\r\n\t *\r\n\t * Parts of the text may override this setting using in-line formatting.\r\n\t *\r\n\t * @param {any} value Font size value\r\n\t */\r\n\tpublic set fontSize(value: any) {\r\n\t\tthis.setPropertyValue(\"fontSize\", value, true);\r\n\t\tthis.setSVGAttribute({ \"font-size\": value });\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current font size for text element.\r\n\t *\r\n\t * @return {any} Font size\r\n\t */\r\n\tpublic get fontSize(): any {\r\n\t\treturn this.getPropertyValue(\"fontSize\");\r\n\t}\r\n\r\n\t/**\r\n\t * Sets font weight to use for text.\r\n\t *\r\n\t * Parts of the text may override this setting using in-line formatting.\r\n\t *\r\n\t * @param {FontWeight} value Font weight\r\n\t */\r\n\tpublic set fontWeigth(value: FontWeight) {\r\n\t\tthis.setPropertyValue(\"fontWeigth\", value);\r\n\t\tthis.setSVGAttribute({ \"font-weight\": value });\r\n\t}\r\n\r\n\t/**\r\n\t * Returns currently set font weight.\r\n\t *\r\n\t * @return {FontWeight} Font weight\r\n\t */\r\n\tpublic get fontWeigth(): FontWeight {\r\n\t\treturn this.getPropertyValue(\"fontWeigth\");\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a text decoration to use for text.\r\n\t *\r\n\t * Parts of the text may override this setting using in-line formatting.\r\n\t *\r\n\t * @param {TextDecoration} value Decoration\r\n\t */\r\n\tpublic set textDecoration(value: TextDecoration) {\r\n\t\tthis.setPropertyValue(\"textDecoration\", value);\r\n\t\tthis.setSVGAttribute({ \"text-decoration\": value });\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current text decoration setting.\r\n\t *\r\n\t * @return {TextDecoration} Decoration\r\n\t */\r\n\tpublic get textDecoration(): TextDecoration {\r\n\t\treturn this.getPropertyValue(\"textDecoration\");\r\n\t}\r\n\r\n\t/**\r\n\t * Sets raw HTML to be used as text.\r\n\t *\r\n\t * NOTE: HTML text is subject to browser support. It relies on browsers\r\n\t * supporting SVG `foreignObject` nodes. Some browsers (read IEs) do not\r\n\t * support it. On those browsers, the text will fall back to basic SVG text,\r\n\t * striping out all HTML markup and styling that goes with it.\r\n\t *\r\n\t * For more information about `foreignObject` and its browser compatibility\r\n\t * refer to [this page](https://developer.mozilla.org/en/docs/Web/SVG/Element/foreignObject#Browser_compatibility).\r\n\t *\r\n\t * @param {string} value HTML text\r\n\t */\r\n\tpublic set html(value: string) {\r\n\t\tthis.setPropertyValue(\"html\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current HTML content of the label.\r\n\t *\r\n\t * @return {string} HTML content\r\n\t */\r\n\tpublic get html(): string {\r\n\t\treturn this.getPropertyValue(\"html\");\r\n\t}\r\n\r\n\t/**\r\n\t * Sets whether the whole text should be hidden if it does not fit into its\r\n\t * allotted space.\r\n\t *\r\n\t * @param {boolean} value Hide if text does not fit?\r\n\t */\r\n\tpublic set hideOversized(value: boolean) {\r\n\t\tthis.setPropertyValue(\"hideOversized\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current setting for hiding oversized text.\r\n\t *\r\n\t * @return {boolean} Hide if text does not fit?\r\n\t */\r\n\tpublic get hideOversized(): boolean {\r\n\t\treturn this.getPropertyValue(\"hideOversized\");\r\n\t}\r\n\r\n\t/**\r\n\t * Override `mesaureElement` so it does not get measure again, because\r\n\t * internal `_bbox` is being updated by measuring routines in Text itself.\r\n\t */\r\n\tprotected measureElement(): void { }\r\n\r\n\t/**\r\n\t * Returns information about a line element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param  {number}         index  Line index\r\n\t * @return {ITextLineInfo}         Line info object\r\n\t */\r\n\tpublic getLineInfo(index: number): ITextLineInfo {\r\n\t\tthis.initLineCache();\r\n\t\tlet lines = this.getCache(\"lineInfo\");\r\n\t\treturn lines.length > index ? lines[index] : undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a line to line info cache.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param {ITextLineInfo}  line     Line info object\r\n\t * @param {boolean}        replace  Replace existing item\r\n\t * @param {number}         index    Insert at specified index\r\n\t */\r\n\tpublic addLineInfo(line: ITextLineInfo, replace?: boolean, index?: number): void {\r\n\t\tthis.initLineCache();\r\n\t\tthis.getCache(\"lineInfo\").push(line);\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if line cache is initialized and initializes it.\r\n\t */\r\n\tprivate initLineCache(): void {\r\n\t\tif (!this.getCache(\"lineInfo\")) {\r\n\t\t\tthis.setCache(\"lineInfo\", []);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a [[DataItem]] to use for populating dynamic sections of the text.\r\n\t *\r\n\t * Check the description for [[Text]] class, for data binding.\r\n\t *\r\n\t * @param {DataItem} dataItem Data item\r\n\t */\r\n\tpublic setDataItem(dataItem: DataItem): void {\r\n\t\tif (this._sourceDataItemEvents) {\r\n\t\t\tthis._sourceDataItemEvents.dispose();\r\n\t\t}\r\n\t\tif(dataItem){\r\n\t\t\tthis._sourceDataItemEvents = new MultiDisposer([\r\n\t\t\t\tdataItem.events.on(\"valuechanged\", this.invalidate, this),\r\n\t\t\t\tdataItem.events.on(\"workingvaluechanged\", this.invalidate, this),\r\n\t\t\t\tdataItem.events.on(\"propertychanged\", this.invalidate, this)\r\n\t\t\t]);\r\n\t\t}\r\n\t\tsuper.setDataItem(dataItem);\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * Returns available horizontal space.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return {number} Available width (px)\r\n\t */\r\n\tpublic get availableWidth(): number {\r\n\t\treturn $type.hasValue(this.maxWidth) ? this.maxWidth : this.pixelWidth;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns available vertical space.\r\n\t *\r\n\t * @return {number} Available height (px)\r\n\t */\r\n\tpublic get availableHeight(): number {\r\n\t\treturn $type.hasValue(this.maxHeight) ? this.maxHeight : this.pixelHeight;\r\n\t}\r\n\r\n\t/**\r\n\t * Invalidates the whole element, causing its redraw.\r\n\t *\r\n\t * Appending `<defs>` section might influence appearance and thus its\r\n\t * dimensions.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic appendDefs() {\r\n\t\tsuper.appendDefs();\r\n\t\tthis.invalidate(); // otherwise getBBOx of text element returns 0 simetimes\r\n\t}\r\n\r\n}\r\n"]}